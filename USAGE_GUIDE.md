# JS Hunter 使用指南

## 快速开始

### 第一步：安装插件

1. 下载或克隆JS Hunter项目
2. 打开Chrome浏览器，访问 `chrome://extensions/`
3. 开启右上角的"开发者模式"
4. 点击"加载已解压的扩展程序"
5. 选择 `js-hunter/extension` 文件夹
6. 安装成功后，工具栏会显示JS Hunter图标

### 第二步：配置API密钥

JS Hunter需要AI API才能进行智能分析。推荐使用Gemini API（免费额度充足）：

1. 访问 [Google AI Studio](https://aistudio.google.com/app/apikey)
2. 登录Google账号
3. 点击"Create API Key"
4. 复制生成的API Key
5. 点击JS Hunter图标 → 设置按钮（齿轮图标）
6. 在"Gemini API Key"字段粘贴API Key
7. 点击"保存设置"

### 第三步：开始使用

1. 访问任意网站（例如：https://example.com）
2. 点击JS Hunter图标
3. 点击"收集所有JS"按钮
4. 等待收集完成（通常几秒钟）
5. 点击"开始分析"按钮
6. 等待AI分析完成
7. 查看发现的安全问题

## 详细功能说明

### 1. JS文件收集

#### 自动收集模式

启用"自动收集"后，JS Hunter会在页面加载时自动收集所有JS文件：

- **外部JS文件**：通过webRequest API拦截
- **内联JS**：解析`<script>`标签内容
- **动态JS**：使用MutationObserver监听动态插入的脚本
- **Eval代码**：拦截eval()、Function()、setTimeout/setInterval

配置路径：设置 → 收集设置 → 自动收集JS文件

#### 手动收集模式

1. 访问目标网站
2. 浏览主要功能页面（触发更多JS加载）
3. 点击"收集所有JS"按钮
4. 查看收集到的文件数量

#### 收集策略

**推荐策略**：
1. 先浏览网站的主要功能页面
2. 登录账号（如果有）
3. 访问不同的功能模块
4. 最后点击"收集所有JS"

**原因**：
- 有些JS文件是懒加载的，只有访问特定页面才会加载
- 登录后可能加载额外的管理功能JS
- 不同模块可能使用不同的JS文件

### 2. AI分析

#### 选择分析场景

JS Hunter提供8种预设分析场景：

| 场景 | 用途 | 推荐使用时机 |
|------|------|------------|
| API接口发现 | 提取所有API端点 | 信息收集阶段 |
| 敏感信息扫描 | 发现API密钥、令牌 | 初始扫描 |
| 认证逻辑分析 | 寻找认证绕过 | 发现登录/权限功能时 |
| 加密算法识别 | 检测弱加密 | 发现加密功能时 |
| 漏洞模式检测 | XSS、注入等 | 全面安全评估 |
| 业务逻辑分析 | 价格篡改等 | 发现支付/交易功能时 |
| 隐藏功能发现 | 找隐藏路由 | 信息收集阶段 |
| 综合安全分析 | 全面评估 | 深度测试 |

#### 配置默认场景

设置 → 分析设置 → 默认分析场景

推荐配置：
- ✅ API接口发现
- ✅ 敏感信息扫描
- ✅ 漏洞模式检测

#### 分析大文件

JS Hunter会自动处理超大JS文件：

1. **自动分块**：文件超过模型上下文限制时，自动分块
2. **智能合并**：分析完成后自动合并结果
3. **进度显示**：显示分块分析进度

支持的最大文件大小：
- Gemini 2.5 Flash：~8MB
- DeepSeek V3：~2MB
- GPT-4.1 Mini：~4MB

### 3. 查看结果

#### Popup界面

快速查看摘要信息：
- JS文件总数
- 已分析文件数
- 发现的问题数
- 最近发现的高危问题

#### DevTools面板

详细的分析结果：
1. 按F12打开开发者工具
2. 切换到"JS Hunter"标签
3. 查看完整的文件列表
4. 点击文件查看详细分析结果

#### 结果筛选

- 按严重程度筛选（Critical/High/Medium/Low）
- 按类型筛选（API/Secret/Vulnerability等）
- 按文件筛选
- 搜索关键词

### 4. 导出报告

#### 支持的格式

1. **JSON**：结构化数据，便于二次处理
2. **HTML**：可视化报告，直接在浏览器查看
3. **PDF**：正式报告，提交给客户
4. **Markdown**：技术文档，集成到知识库

#### 导出步骤

1. 在DevTools面板选择要导出的文件/结果
2. 点击"导出"按钮
3. 选择导出格式
4. 选择导出内容：
   - ✅ JS文件列表
   - ✅ 分析结果
   - ✅ 统计信息
5. 点击"确认导出"
6. 文件会自动下载

## 实战案例

### 案例1：发现隐藏的Admin后台

**目标网站**：某电商平台

**步骤**：
1. 访问网站首页
2. 收集JS文件（发现23个文件）
3. 选择"隐藏功能发现"场景分析
4. AI发现：
   ```javascript
   // 在router.js中发现
   {
     path: '/admin/dashboard',
     component: AdminDashboard,
     meta: { requiresAuth: true, role: 'admin' }
   }
   ```
5. 尝试访问 `/admin/dashboard`
6. 发现前端权限检查可绕过
7. 成功进入管理后台

**关键发现**：
- 隐藏路由：`/admin/dashboard`
- 权限检查：仅在前端进行
- 绕过方法：直接访问URL

### 案例2：API密钥泄露

**目标网站**：某SaaS平台

**步骤**：
1. 访问网站并登录
2. 收集JS文件（发现15个文件）
3. 选择"敏感信息扫描"场景
4. AI发现：
   ```javascript
   // 在config.js中发现
   const STRIPE_PUBLIC_KEY = 'pk_live_51H...'
   const INTERNAL_API_KEY = 'sk_prod_xyz123...'
   ```
5. 验证API密钥有效性
6. 发现可以调用内部API

**关键发现**：
- Stripe公钥（正常）
- 内部API密钥（高危）
- 可利用密钥访问内部API

### 案例3：价格篡改漏洞

**目标网站**：某在线商城

**步骤**：
1. 访问商品页面
2. 添加商品到购物车
3. 进入结算页面
4. 收集JS文件
5. 选择"业务逻辑分析"场景
6. AI发现：
   ```javascript
   // 在checkout.js中发现
   function submitOrder() {
     const totalPrice = calculateTotal();
     fetch('/api/orders', {
       method: 'POST',
       body: JSON.stringify({
         items: cart.items,
         totalPrice: totalPrice  // 客户端计算的价格
       })
     });
   }
   ```
7. 拦截请求，修改totalPrice为0.01
8. 成功以0.01元下单

**关键发现**：
- 价格计算在客户端进行
- 服务端未验证价格
- 可以任意修改价格

### 案例4：认证Token伪造

**目标网站**：某企业内部系统

**步骤**：
1. 访问登录页面
2. 收集JS文件
3. 选择"认证逻辑分析"场景
4. AI发现：
   ```javascript
   // 在auth.js中发现
   function generateToken(userId, role) {
     return btoa(JSON.stringify({
       userId: userId,
       role: role,
       timestamp: Date.now()
     }));
   }
   ```
5. 分析Token生成逻辑
6. 发现Token仅为Base64编码，无签名
7. 伪造Admin Token：
   ```javascript
   btoa(JSON.stringify({
     userId: 1,
     role: 'admin',
     timestamp: Date.now()
   }))
   ```
8. 使用伪造Token成功提权

**关键发现**：
- Token无签名验证
- Token结构可预测
- 可以伪造任意角色Token

## 高级技巧

### 技巧1：结合Burp Suite使用

1. 在Burp Suite中浏览目标网站
2. 使用JS Hunter收集JS文件
3. 在Burp Suite中查看HTTP历史
4. 对比JS Hunter发现的API端点
5. 使用Burp Suite进行深度测试

### 技巧2：自定义分析模板

针对特定目标创建自定义模板：

```
分析以下JavaScript代码，重点关注：
1. 所有与支付相关的函数
2. 价格计算逻辑
3. 优惠券验证逻辑
4. 是否存在客户端价格计算

输出JSON格式：
{
  "paymentFunctions": [...],
  "priceCalculation": {...},
  "vulnerabilities": [...]
}

代码：
{{CODE}}
```

### 技巧3：批量分析多个域名

1. 创建项目："目标公司渗透测试"
2. 访问主域名，收集JS
3. 访问子域名，收集JS
4. 访问API域名，收集JS
5. 在项目中批量分析所有文件
6. 导出综合报告

### 技巧4：监控JS变化

定期收集同一网站的JS文件：
1. 第一次收集：2024-01-01
2. 第二次收集：2024-02-01
3. 对比两次收集的文件
4. 分析新增/修改的JS
5. 发现新功能和新漏洞

## 常见问题

### Q1：为什么收集不到JS文件？

**可能原因**：
1. 网站使用了反爬虫机制
2. JS文件是动态加载的
3. 需要登录才能加载某些JS

**解决方法**：
1. 先登录账号
2. 浏览所有功能页面
3. 手动触发功能（点击按钮、打开弹窗等）
4. 再点击"收集所有JS"

### Q2：分析失败怎么办？

**可能原因**：
1. API密钥无效或额度用完
2. 文件太大，超过模型限制
3. 网络问题

**解决方法**：
1. 检查API密钥配置
2. 检查API额度
3. 尝试其他AI模型
4. 检查网络连接

### Q3：如何提高分析准确性？

**建议**：
1. 使用Gemini 2.5 Flash（上下文最大）
2. 对单个文件进行深度分析
3. 使用多个分析场景
4. 手动审查AI结果
5. 结合人工经验判断

### Q4：数据存储在哪里？

所有数据存储在本地浏览器的IndexedDB中：
- 路径：`chrome://indexeddb-internals/`
- 数据库名：`JSHunterDB`
- 不会上传到任何服务器
- 卸载插件后数据会被删除

### Q5：如何清空数据？

方法1：在设置页面
- 设置 → 清空所有数据

方法2：手动清除
- `chrome://extensions/` → JS Hunter → 删除扩展数据

## 最佳实践

### 渗透测试流程

```
1. 信息收集阶段
   ├─ 访问目标网站所有页面
   ├─ 收集所有JS文件
   ├─ 使用"API接口发现"分析
   ├─ 使用"敏感信息扫描"分析
   └─ 使用"隐藏功能发现"分析

2. 漏洞挖掘阶段
   ├─ 针对登录功能：使用"认证逻辑分析"
   ├─ 针对支付功能：使用"业务逻辑分析"
   ├─ 针对加密功能：使用"加密算法识别"
   └─ 全面扫描：使用"漏洞模式检测"

3. 深度分析阶段
   ├─ 对重点JS文件进行"综合安全分析"
   ├─ 手动审查AI发现的问题
   ├─ 使用Burp Suite验证漏洞
   └─ 编写PoC

4. 报告编写阶段
   ├─ 导出分析结果
   ├─ 整理漏洞列表
   ├─ 编写利用步骤
   └─ 提供修复建议
```

### 安全建议

1. **仅用于授权测试**：未经授权的测试是违法的
2. **保护API密钥**：不要分享你的API密钥
3. **定期清理数据**：测试完成后清空敏感数据
4. **遵守法律法规**：了解并遵守当地法律

## 更新日志

### v1.0.0 (2024-01-01)
- ✨ 首次发布
- ✅ 支持3种AI模型
- ✅ 8种分析场景
- ✅ 自动JS收集
- ✅ DevTools集成
- ✅ 数据导出

## 反馈与支持

- GitHub Issues: 提交Bug和功能建议
- Email: support@jshunter.com
- Discord: 加入社区讨论

---

**祝你挖洞愉快！🎯**
