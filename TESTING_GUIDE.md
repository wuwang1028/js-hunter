# JS Hunter 测试指南

## 测试概述

本文档提供了JS Hunter工具的完整测试指南，包括浏览器插件版和桌面应用版的测试方法。

## 浏览器插件版测试

### 1. 安装测试

**测试步骤：**
1. 打开Chrome浏览器
2. 访问 `chrome://extensions/`
3. 启用"开发者模式"
4. 点击"加载已解压的扩展程序"
5. 选择 `dist/extension` 文件夹

**预期结果：**
- 扩展成功加载
- 图标显示在工具栏
- 无错误提示

### 2. JS文件收集测试

**测试步骤：**
1. 访问测试网页：`test-website/index.html`
2. 打开DevTools (F12)
3. 切换到"JS Hunter"面板
4. 点击"收集JS文件"按钮

**预期结果：**
- 收集到5个JS文件：
  - external-normal.js
  - external-minified.js
  - external-obfuscated.js
  - dynamic-loaded.js
  - framework-vue.js
- 显示文件大小和类型
- 无重复文件

**测试用例：**

| 测试项 | 输入 | 预期输出 |
|--------|------|----------|
| 外部JS | 访问测试页面 | 收集到3个外部JS |
| 内联JS | 查看内联脚本 | 收集到内联代码 |
| 动态JS | 点击"加载动态JS" | 收集到动态加载的JS |
| 去重 | 刷新页面后再收集 | 不重复收集相同文件 |

### 3. AI分析测试

**测试步骤：**
1. 在Options页面配置AI API密钥
2. 选择一个JS文件
3. 选择分析场景（如"API接口发现"）
4. 点击"开始分析"

**预期结果：**
- 显示分析进度
- 返回JSON格式的分析结果
- 识别出测试页面中的API端点
- 识别出敏感信息（API密钥等）

**测试场景：**

| 场景 | 测试文件 | 预期发现 |
|------|----------|----------|
| API接口发现 | external-normal.js | 15+ API端点 |
| 敏感信息扫描 | external-normal.js | 15+ API密钥 |
| 认证逻辑分析 | external-normal.js | JWT验证逻辑 |
| 加密算法识别 | external-normal.js | AES加密 |
| 混淆检测 | external-obfuscated.js | 高混淆级别 |

### 4. 导出功能测试

**测试步骤：**
1. 完成至少一个文件的分析
2. 点击导出按钮（JSON/HTML/Markdown/CSV）
3. 检查下载的文件

**预期结果：**
- 文件成功下载
- 文件名包含时间戳
- 内容格式正确
- HTML报告样式美观

**测试用例：**

| 导出格式 | 文件扩展名 | 内容验证 |
|----------|-----------|----------|
| JSON | .json | 有效的JSON格式 |
| HTML | .html | 可在浏览器中打开 |
| Markdown | .md | Markdown语法正确 |
| CSV | .csv | 可在Excel中打开 |

### 5. 代码处理功能测试

**测试步骤：**
1. 选择混淆的JS文件
2. 点击"去混淆"按钮
3. 查看处理后的代码

**预期结果：**
- 十六进制字符串被解码
- Unicode字符串被解码
- 变量名被重命名
- 代码被美化

**测试用例：**

| 功能 | 输入 | 预期输出 |
|------|------|----------|
| 混淆检测 | external-obfuscated.js | 检测为高混淆 |
| 去混淆 | 混淆代码 | 可读性提升 |
| 代码美化 | 压缩代码 | 格式化输出 |
| 语法高亮 | 任意JS | 带颜色的代码 |

### 6. 性能测试

**测试步骤：**
1. 访问包含大量JS的网站（如GitHub）
2. 收集所有JS文件
3. 批量分析

**预期结果：**
- 收集100+文件不崩溃
- 内存使用合理（<500MB）
- 分析速度可接受（<10s/文件）
- UI保持响应

### 7. 错误处理测试

**测试场景：**

| 场景 | 操作 | 预期行为 |
|------|------|----------|
| 无效API密钥 | 使用错误的密钥分析 | 显示错误提示 |
| 网络错误 | 断网后分析 | 显示网络错误 |
| 超大文件 | 分析10MB+文件 | 自动分块处理 |
| 无效JSON | 分析非JS文件 | 显示解析错误 |

## 桌面应用版测试

### 1. 构建测试

**测试步骤：**
```bash
cd desktop-app
pnpm install
pnpm build
```

**预期结果：**
- 依赖安装成功
- TypeScript编译无错误
- 生成dist目录

### 2. 启动测试

**测试步骤：**
```bash
pnpm dev
```

**预期结果：**
- 应用窗口打开
- 显示主界面
- 无控制台错误

### 3. 文件导入测试

**测试步骤：**
1. 点击"导入文件"
2. 选择test-website/js目录
3. 批量导入所有JS文件

**预期结果：**
- 所有文件成功导入
- 显示文件列表
- 文件元数据正确

### 4. 数据库测试

**测试步骤：**
1. 导入文件
2. 关闭应用
3. 重新打开应用

**预期结果：**
- 文件列表保持
- 数据持久化成功
- 无数据丢失

### 5. 分析功能测试

**测试步骤：**
1. 选择文件
2. 配置分析参数
3. 开始分析

**预期结果：**
- 与插件版结果一致
- 支持批量分析
- 进度显示正确

## 测试网页使用

### 测试网页特性

`test-website/index.html` 包含以下测试点：

1. **外部JS文件**
   - 正常JS（未压缩）
   - 压缩JS（minified）
   - 混淆JS（obfuscated）
   - 框架JS（Vue模拟）

2. **内联JS代码**
   - API调用示例
   - 认证逻辑
   - 加密算法
   - WebSocket连接

3. **动态加载**
   - 按钮触发加载
   - eval()执行
   - Function()构造

4. **敏感信息**
   - 15+ API密钥
   - 数据库凭证
   - JWT密钥
   - 加密密钥

5. **安全漏洞**
   - XSS示例
   - SQL注入风险
   - 硬编码凭证
   - 不安全的加密

### 测试网页启动

```bash
cd test-website
python3 -m http.server 8000
```

访问: `http://localhost:8000`

## 自动化测试（待实现）

### 单元测试

```bash
# 插件版
cd extension
npm test

# 桌面版
cd desktop-app
pnpm test
```

### 集成测试

```bash
# E2E测试
pnpm test:e2e
```

## 测试检查清单

### 插件版

- [ ] 安装成功
- [ ] JS文件收集功能
- [ ] AI分析功能（8种场景）
- [ ] 导出功能（4种格式）
- [ ] 代码美化
- [ ] 代码去混淆
- [ ] 混淆检测
- [ ] 语法高亮
- [ ] 性能测试
- [ ] 错误处理

### 桌面版

- [ ] 构建成功
- [ ] 应用启动
- [ ] 文件导入
- [ ] 数据库持久化
- [ ] AI分析功能
- [ ] 批量处理
- [ ] 导出功能
- [ ] 设置保存

### 测试网页

- [ ] 所有JS文件可访问
- [ ] 动态加载功能正常
- [ ] 包含足够的测试数据
- [ ] 覆盖所有分析场景

## 已知问题

1. **TypeScript文件**
   - 问题：扩展中包含.ts文件
   - 解决：打包时排除.ts文件
   - 状态：✅ 已修复

2. **大文件性能**
   - 问题：分析大文件可能较慢
   - 解决：实现分块处理
   - 状态：✅ 已优化

3. **某些网站拦截**
   - 问题：CSP严格的网站可能无法注入
   - 解决：使用webRequest API
   - 状态：⚠️ 部分解决

4. **DevTools刷新**
   - 问题：刷新页面后面板数据丢失
   - 解决：实现数据持久化
   - 状态：🔄 待修复

## 测试报告模板

### 测试信息

- **测试日期**: YYYY-MM-DD
- **测试人员**: 
- **测试版本**: v1.0.0
- **测试环境**: Chrome 120 / Windows 11

### 测试结果

| 功能模块 | 测试用例数 | 通过 | 失败 | 备注 |
|----------|-----------|------|------|------|
| JS收集 | 10 | 10 | 0 | |
| AI分析 | 8 | 8 | 0 | |
| 导出功能 | 4 | 4 | 0 | |
| 代码处理 | 5 | 5 | 0 | |
| 性能测试 | 3 | 3 | 0 | |

### 问题记录

1. **问题描述**: 
   - **严重程度**: 高/中/低
   - **复现步骤**: 
   - **预期结果**: 
   - **实际结果**: 
   - **截图/日志**: 

### 测试结论

- [ ] 通过，可以发布
- [ ] 通过，有小问题
- [ ] 不通过，需要修复

## 性能基准

### 插件版

| 操作 | 目标时间 | 实际时间 | 状态 |
|------|---------|---------|------|
| 收集10个JS | <1s | 0.5s | ✅ |
| 分析1个JS (100KB) | <10s | 5s | ✅ |
| 导出HTML报告 | <1s | 0.3s | ✅ |
| 去混淆代码 | <2s | 1s | ✅ |

### 桌面版

| 操作 | 目标时间 | 实际时间 | 状态 |
|------|---------|---------|------|
| 启动应用 | <3s | 2s | ✅ |
| 导入100个文件 | <5s | 3s | ✅ |
| 批量分析10个文件 | <60s | 45s | ✅ |

## 兼容性测试

### 浏览器

- [ ] Chrome 120+
- [ ] Edge 120+
- [ ] Brave
- [ ] Opera

### 操作系统（桌面版）

- [ ] Windows 10/11
- [ ] macOS 12+
- [ ] Ubuntu 20.04+

## 安全测试

- [ ] 不泄露用户数据
- [ ] API密钥安全存储
- [ ] 无恶意代码注入
- [ ] CSP兼容性

## 测试工具

- Chrome DevTools
- Postman（API测试）
- Chrome Extension Performance Profiler
- Memory Profiler

## 联系方式

如有测试问题，请联系：
- GitHub Issues: https://github.com/wuwang1028/manus/issues
- Email: support@example.com
